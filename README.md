# BiliBili åŠ¨æ€æ¨é€ Bot v1.0

ç”±[bilibili-dynamic-mirai-plugin](https://github.com/Colter23/bilibili-dynamic-mirai-plugin)æ”¹é€ è€Œæ¥ã€‚
ä»£ç éƒ¨åˆ†åˆ™ç”±[claude](https://github.com/claude)å€¾åŠ›æ‰“é€ ã€‚
è¿™æ˜¯åŸºäº NapCat çš„ Bç«™åŠ¨æ€æ¨é€æœºå™¨äººï¼Œæ”¯æŒåŠ¨æ€è®¢é˜…ã€ç›´æ’­é€šçŸ¥ã€é“¾æ¥è§£æç­‰åŠŸèƒ½ã€‚

## é¡¹ç›®ç»“æ„

```
dynamic-bot/
â”œâ”€â”€ src/                    # æºä»£ç ç›®å½•
â”‚   â”œâ”€â”€ main/
â”‚   â”‚   â”œâ”€â”€ kotlin/        # Kotlin æºä»£ç 
â”‚   â”‚   â”‚   â””â”€â”€ top/
â”‚   â”‚   â”‚       â””â”€â”€ bilibili/
â”‚   â”‚   â”‚           â”œâ”€â”€ api/           # Bç«™ API æ¥å£
â”‚   â”‚   â”‚           â”œâ”€â”€ client/        # HTTP å®¢æˆ·ç«¯
â”‚   â”‚   â”‚           â”œâ”€â”€ config/        # é…ç½®ç®¡ç†
â”‚   â”‚   â”‚           â”œâ”€â”€ core/          # æ ¸å¿ƒæ¨¡å—
â”‚   â”‚   â”‚           â”œâ”€â”€ data/          # æ•°æ®æ¨¡å‹
â”‚   â”‚   â”‚           â”œâ”€â”€ draw/          # å›¾ç‰‡æ¸²æŸ“
â”‚   â”‚   â”‚           â”œâ”€â”€ napcat/        # NapCat å®¢æˆ·ç«¯
â”‚   â”‚   â”‚           â”œâ”€â”€ service/       # ä¸šåŠ¡æœåŠ¡
â”‚   â”‚   â”‚           â”œâ”€â”€ tasker/        # å®šæ—¶ä»»åŠ¡
â”‚   â”‚   â”‚           â”œâ”€â”€ utils/         # å·¥å…·ç±»
â”‚   â”‚   â”‚           â”œâ”€â”€ BiliConfig.kt  # é…ç½®æ–‡ä»¶
â”‚   â”‚   â”‚           â”œâ”€â”€ BiliData.kt    # æ•°æ®æ–‡ä»¶
â”‚   â”‚   â”‚           â””â”€â”€ Main.kt        # ç¨‹åºå…¥å£
â”‚   â”‚   â””â”€â”€ resources/     # èµ„æºæ–‡ä»¶
â”‚   â”‚       â””â”€â”€ font/      # å­—ä½“æ–‡ä»¶ï¼ˆå¯é€‰ï¼‰
â”‚   â””â”€â”€ test/              # ï¼ˆå·²åˆ é™¤æ—§çš„ Mirai æµ‹è¯•ï¼‰
â”œâ”€â”€ gradle/                # Gradle wrapper
â”œâ”€â”€ build.gradle.kts       # Gradle æ„å»ºè„šæœ¬
â”œâ”€â”€ settings.gradle.kts    # Gradle è®¾ç½®
â”œâ”€â”€ gradle.properties      # Gradle å±æ€§
â”œâ”€â”€ gradlew                # Gradle wrapper è„šæœ¬ï¼ˆLinux/Macï¼‰
â”œâ”€â”€ gradlew.bat            # Gradle wrapper è„šæœ¬ï¼ˆWindowsï¼‰
â”œâ”€â”€ .env.example           # ç¯å¢ƒå˜é‡ç¤ºä¾‹
â”œâ”€â”€ .gitignore             # Git å¿½ç•¥æ–‡ä»¶
â”œâ”€â”€ Dockerfile             # Docker é•œåƒæ„å»ºæ–‡ä»¶
â”œâ”€â”€ docker-compose.yml     # Docker Compose é…ç½®
â”œâ”€â”€ README.md              # é¡¹ç›®è¯´æ˜
â””â”€â”€ LICENSE                # è®¸å¯è¯

```

## å¿«é€Ÿå¼€å§‹

### 1. ç¼–è¯‘é¡¹ç›®

```bash
# Windows
.\gradlew.bat build -x test

# Linux/Mac
./gradlew build -x test
```

ç¼–è¯‘å®Œæˆåï¼Œå¯æ‰§è¡Œæ–‡ä»¶ä½äºï¼š
- `build/libs/dynamic-bot-1.0.jar`

### 2. é…ç½®æ–‡ä»¶

é¦–æ¬¡è¿è¡Œæ—¶ï¼Œç¨‹åºä¼šè‡ªåŠ¨åˆ›å»ºé…ç½®æ–‡ä»¶ç›®å½•ç»“æ„ï¼š

```
config/
â”œâ”€â”€ bot.yml          # Bot åŸºç¡€é…ç½®ï¼ˆNapCat è¿æ¥ä¿¡æ¯ï¼‰
â””â”€â”€ data.yml         # è®¢é˜…æ•°æ®å’Œæ¨é€é…ç½®

data/
â”œâ”€â”€ font/            # å­—ä½“æ–‡ä»¶ç›®å½•
â””â”€â”€ cookies.json     # Bç«™ Cookieï¼ˆå¯é€‰ï¼‰
```

### 3. è¿è¡Œ Bot

```bash
java -jar build/libs/dynamic-bot-1.0.jar
```

æˆ–è€…ä½¿ç”¨ Dockerï¼š

```bash
docker-compose up -d
```

## ä¸»è¦åŠŸèƒ½

### 1. é“¾æ¥è§£æ
- è‡ªåŠ¨è§£æç¾¤æ¶ˆæ¯ä¸­çš„ Bç«™é“¾æ¥
- æ”¯æŒè§†é¢‘ã€åŠ¨æ€ã€ç›´æ’­ã€ç•ªå‰§ã€ä¸“æ ç­‰å¤šç§ç±»å‹
- æ”¯æŒ QQ å°ç¨‹åºåˆ†äº«çš„ Bç«™é“¾æ¥
- ç”Ÿæˆç²¾ç¾çš„å›¾æ–‡å¡ç‰‡
- è¿”å›æ ‡å‡†çš„ BV å·é“¾æ¥

### 2. åŠ¨æ€è®¢é˜…
- è®¢é˜… Bç«™ç”¨æˆ·çš„åŠ¨æ€
- è‡ªåŠ¨æ£€æµ‹æ–°åŠ¨æ€å¹¶æ¨é€åˆ°ç¾¤èŠ/ç§èŠ
- æ”¯æŒè‡ªå®šä¹‰æ¨é€æ¨¡æ¿
- æ”¯æŒç›´æ’­å¼€æ’­/å…³æ’­é€šçŸ¥

### 3. ç®¡ç†å‘½ä»¤

#### åŸºç¡€å‘½ä»¤
- `/subscribe <UID>` - è®¢é˜…ç”¨æˆ·
- `/unsubscribe <UID>` - å–æ¶ˆè®¢é˜…
- `/list` - æŸ¥çœ‹è®¢é˜…åˆ—è¡¨
- `/check` - æ‰‹åŠ¨è§¦å‘æ£€æŸ¥ï¼ˆæµ‹è¯•ç”¨ï¼‰
- `/login` - Bç«™æ‰«ç ç™»å½•

#### é«˜çº§å‘½ä»¤ï¼ˆ/biliï¼‰
- `/bili help` - æ˜¾ç¤ºå®Œæ•´å¸®åŠ©
- `/bili add <UID> <ç¾¤å·>` - å°† UPä¸»æ·»åŠ åˆ°æŒ‡å®šç¾¤
- `/bili list` - æŸ¥çœ‹å½“å‰ç¾¤è®¢é˜…ï¼ˆæ— å‚ï¼‰
- `/bili list <UID>` - æŸ¥çœ‹ UID æ¨é€åˆ°å“ªäº›ç¾¤
- `/bili group create <åˆ†ç»„å>` - åˆ›å»ºç¾¤ç»„åˆ†ç»„
- `/bili group subscribe <åˆ†ç»„å> <UID>` - è®¢é˜…åˆ°åˆ†ç»„
- `/bili groups` - æŸ¥çœ‹æ‰€æœ‰åˆ†ç»„ä¿¡æ¯

## é…ç½®è¯´æ˜

### bot.yml ç¤ºä¾‹

```yaml
# NapCat WebSocket é…ç½®
napcat:
  host: "127.0.0.1"
  port: 3001
  accessToken: ""  # å¦‚æœè®¾ç½®äº†è®¿é—®ä»¤ç‰Œ

# ç®¡ç†å‘˜ QQ å·
admin: 123456789
```

### data.yml ç¤ºä¾‹

```yaml
# åŠ¨æ€è®¢é˜…æ•°æ®
dynamic:
  # UID: è®¢é˜…ä¿¡æ¯
  123456:
    name: "ç”¨æˆ·å"
    contacts:
      - "group:987654321"  # ç¾¤èŠ
      - "private:123456789"  # ç§èŠ
    banList: {}

# æ£€æŸ¥é…ç½®
checkConfig:
  interval: 15  # åŠ¨æ€æ£€æŸ¥é—´éš”ï¼ˆç§’ï¼‰
  liveInterval: 15  # ç›´æ’­æ£€æŸ¥é—´éš”ï¼ˆç§’ï¼‰
  timeout: 10  # API è¯·æ±‚è¶…æ—¶ï¼ˆç§’ï¼‰

# æ¨é€é…ç½®
pushConfig:
  toShortLink: false  # æ˜¯å¦ä½¿ç”¨çŸ­é“¾æ¥
  pushInterval: 1000  # æ¨é€é—´éš”ï¼ˆæ¯«ç§’ï¼‰
  messageInterval: 500  # æ¶ˆæ¯é—´éš”ï¼ˆæ¯«ç§’ï¼‰

# ç¼“å­˜é…ç½®
cacheConfig:
  expires:
    "DRAW": 7        # ç»˜å›¾ç¼“å­˜ä¿ç•™7å¤©
    "IMAGES": 7      # å›¾ç‰‡ç¼“å­˜ä¿ç•™7å¤©
    "EMOJI": 7       # è¡¨æƒ…ç¼“å­˜ä¿ç•™7å¤©

# é“¾æ¥è§£æé…ç½®
linkResolveConfig:
  triggerMode: "Always"  # è§¦å‘æ¨¡å¼ï¼šAlways/At/Never
  returnLink: true  # æ˜¯å¦è¿”å›é“¾æ¥

# æ¨é€æ¨¡æ¿é…ç½®
dynamicPush: "{draw}\n{name}@{type}\n{link}"
livePush: "{draw}\n{name}@ç›´æ’­\n{link}"
liveClose: "{name} ç›´æ’­ç»“æŸå•¦!\nç›´æ’­æ—¶é•¿: {duration}"

# åŠŸèƒ½å¼€å…³
drawEnable: true  # å¯ç”¨å›¾ç‰‡ç”Ÿæˆ
liveCloseNotifyEnable: true  # å¯ç”¨ä¸‹æ’­é€šçŸ¥
cacheClearEnable: true  # å¯ç”¨å®šæ—¶ç¼“å­˜æ¸…ç†
```

## Docker éƒ¨ç½²

### å¿«é€Ÿéƒ¨ç½²

1. **é…ç½® NapCat è¿æ¥**
   - ä¿®æ”¹ `config/bot.yml` ä¸­çš„ host ä¸º `host.docker.internal`ï¼ˆå¦‚æœ NapCat åœ¨å®¿ä¸»æœºï¼‰
   - æˆ–ä¿æŒ `127.0.0.1`ï¼ˆå¦‚æœ NapCat ä¹Ÿåœ¨å®¹å™¨å†…ï¼‰

2. **æ„å»ºé•œåƒ**
   ```bash
   docker compose build
   ```

3. **å¯åŠ¨å®¹å™¨**
   ```bash
   docker compose up -d
   ```

4. **æŸ¥çœ‹æ—¥å¿—**
   ```bash
   docker compose logs -f
   ```

### å®¹å™¨é…ç½®

- **åŸºç¡€é•œåƒ**: eclipse-temurin:17-jre-jammy
- **JVM å‚æ•°**: `-Xms256m -Xmx512m -XX:+UseG1GC`
- **å¥åº·æ£€æŸ¥**: æ¯30ç§’æ£€æŸ¥ä¸€æ¬¡è¿›ç¨‹çŠ¶æ€
- **æ—¥å¿—é™åˆ¶**: 10MB Ã— 3 æ–‡ä»¶ï¼ˆè‡ªåŠ¨è½®è½¬ï¼‰
- **é‡å¯ç­–ç•¥**: unless-stopped

### è‡ªåŠ¨åŒ–è„šæœ¬

Windows ç”¨æˆ·å¯ä½¿ç”¨ `docker-deploy.ps1` è„šæœ¬ï¼š
```powershell
.\docker-deploy.ps1 build   # æ„å»ºé•œåƒ
.\docker-deploy.ps1 start   # å¯åŠ¨å®¹å™¨
.\docker-deploy.ps1 stop    # åœæ­¢å®¹å™¨
.\docker-deploy.ps1 logs    # æŸ¥çœ‹æ—¥å¿—
```

## å¼€å‘è¯´æ˜

### æŠ€æœ¯æ ˆ
- Kotlin 1.9.22
- Ktor 2.3.7ï¼ˆHTTP å®¢æˆ·ç«¯ï¼‰
- Skiko 0.7.93ï¼ˆå›¾ç‰‡æ¸²æŸ“ï¼‰
- kotlinx.serializationï¼ˆJSON å¤„ç†ï¼‰
- kotlinx.coroutinesï¼ˆåç¨‹ï¼‰
- OneBot v11 åè®®ï¼ˆNapCatï¼‰

### é¡¹ç›®ç‰¹ç‚¹
- ç‹¬ç«‹è¿è¡Œï¼Œä¸ä¾èµ– Mirai æ¡†æ¶
- ä½¿ç”¨ NapCat ä½œä¸º QQ æœºå™¨äººæ¡†æ¶
- åŸºäº WebSocket é€šä¿¡
- ä½¿ç”¨ Skiko è¿›è¡Œé«˜è´¨é‡å›¾ç‰‡æ¸²æŸ“
- æ”¯æŒ Docker éƒ¨ç½²

## ä¸åŸé¡¹ç›®çš„åŒºåˆ«

1. **ç§»é™¤äº†ä»¥ä¸‹å†…å®¹**ï¼š
   - Mirai æ¡†æ¶ç›¸å…³ä»£ç å’Œæµ‹è¯•
   - ç¼–è¯‘è¾“å‡ºï¼ˆbuild/ã€.gradle/ï¼‰
   - IDE é…ç½®æ–‡ä»¶ï¼ˆ.idea/ã€.kotlin/ï¼‰
   - ä¸´æ—¶æ–‡ä»¶å’Œè¿è¡Œæ—¶æ•°æ®

2. **ä¿ç•™äº†ä»¥ä¸‹å†…å®¹**ï¼š
   - å®Œæ•´çš„æºä»£ç 
   - Gradle æ„å»ºé…ç½®
   - Docker éƒ¨ç½²æ–‡ä»¶
   - æ–‡æ¡£å’Œç¤ºä¾‹é…ç½®

## æ›´æ–°æ—¥å¿—

### v1.0 (2026-01-04)

**æ ¸å¿ƒä¿®å¤**
- âœ… æ•°æ®æŒä¹…åŒ–é—®é¢˜ï¼šå®ç° BiliDataWrapper åŒ…è£…ç±»ï¼Œè§£å†³ object var å­—æ®µåºåˆ—åŒ–é—®é¢˜
- âœ… æ¨é€åŠŸèƒ½å¤±è´¥ï¼šä¿®å¤è”ç³»äºº ID æ ¼å¼å…¼å®¹é—®é¢˜ï¼ˆæ”¯æŒ `group:123456` å’Œ `g123456`ï¼‰
- âœ… èµ„æºæ–‡ä»¶åŠ è½½ï¼šä½¿ç”¨ ClassLoader åŠ è½½èµ„æºï¼Œä¿®å¤ JAR ä¸­ SVG å›¾æ ‡æ— æ³•åŠ è½½é—®é¢˜
- âœ… åŠ¨æ€æ£€æŸ¥å¤±è´¥ï¼šä¿®æ­£ lastDynamic åˆå§‹åŒ–é€»è¾‘ï¼Œé¿å…é—æ¼å·²å‘å¸ƒåŠ¨æ€
- âœ… ç›´æ’­æ¨é€å¤±è´¥ï¼šä¿®æ­£ lastLive æ—¶é—´çª—å£ï¼Œç¡®ä¿ä¸é—æ¼å·²å¼€æ’­çš„ç›´æ’­

**åŠŸèƒ½å¢å¼º**
- ğŸš€ ç™½åå•ä¸åˆ†ç»„ç®¡ç†ï¼šæ”¯æŒç²¾ç¡®æ§åˆ¶æ¨é€èŒƒå›´ï¼Œæ‰¹é‡è®¢é˜…ç®¡ç†
- ğŸš€ åŒæºç›´æ’­æ£€æŸ¥ï¼šåŒæ—¶æ£€æŸ¥å…³æ³¨åˆ—è¡¨å’Œè®¢é˜…åˆ—è¡¨ä¸­çš„ç›´æ’­çŠ¶æ€
- ğŸš€ ç¼“å­˜è‡ªåŠ¨æ¸…ç†ï¼šå¯åŠ¨æ—¶å’Œå®šæ—¶æ¸…ç†è¿‡æœŸç¼“å­˜ï¼Œå¯é…ç½®ä¿ç•™æ—¶é—´
- ğŸš€ æ—¥å¿—ä¼˜åŒ–ï¼šç®€åŒ–æ§åˆ¶å°è¾“å‡ºï¼Œé™çº§ NapCat é‡å¤æ—¥å¿—

**é…ç½®æ”¹è¿›**
- ğŸ“ æ•°æ®æ–‡ä»¶è¿ç§»ï¼šä» `data/BiliData.yml` è‡ªåŠ¨è¿ç§»åˆ° `config/BiliData.yml`
- ğŸ“ æ£€æŸ¥é—´éš”ä¼˜åŒ–ï¼šåŠ¨æ€æ£€æŸ¥å’Œç›´æ’­æ£€æŸ¥ç‹¬ç«‹é…ç½®ï¼ˆé»˜è®¤15ç§’ï¼‰
- ğŸ“ æ¨é€æ¨¡æ¿æ‰©å±•ï¼šæ”¯æŒè‡ªå®šä¹‰åŠ¨æ€ã€ç›´æ’­ã€ä¸‹æ’­é€šçŸ¥æ¨¡æ¿

### æ—©æœŸç‰ˆæœ¬

1. **é“¾æ¥è§£æå¢å¼º**
   - æ·»åŠ äº† QQ å°ç¨‹åºé“¾æ¥è§£ææ”¯æŒ
   - çŸ­é“¾æ¥è‡ªåŠ¨è½¬æ¢ä¸ºæ ‡å‡† BV å·
   - ä¼˜åŒ–äº†æ— é™å¾ªç¯é˜²æŠ¤æœºåˆ¶

2. **ç•ªå‰§æ¸²æŸ“ä¼˜åŒ–**
   - æ·»åŠ äº†ç•ªå‰§ä»‹ç»æ˜¾ç¤º
   - æ–°å¢å…ƒä¿¡æ¯æ˜¾ç¤ºï¼ˆæ ‡ç­¾ã€é¦–æ’­æ—¶é—´ã€å®Œç»“çŠ¶æ€ã€é›†æ•°ç­‰ï¼‰
   - ä¼˜åŒ–äº†å¸ƒå±€ï¼Œå‡å°‘ç©ºç™½åŒºåŸŸ

3. **å­—ä½“åŠ è½½æ”¹è¿›**
   - æ”¯æŒä» resources ç›®å½•åŠ è½½å­—ä½“
   - å­—ä½“æ–‡ä»¶å¯ä»¥æ‰“åŒ…åˆ° JAR ä¸­
   - æ— éœ€æ‰‹åŠ¨ä¸‹è½½å­—ä½“æ–‡ä»¶

4. **è®¢é˜…åŠŸèƒ½å®Œå–„**
   - æ·»åŠ äº†è®¢é˜…ç®¡ç†å‘½ä»¤
   - æ”¯æŒæ‰‹åŠ¨è§¦å‘æ£€æŸ¥ï¼ˆ/checkï¼‰
   - ä¼˜åŒ–äº†æ¨é€é€»è¾‘

## è®¸å¯è¯

æœ¬é¡¹ç›®åŸºäº AGPL-3.0 è®¸å¯è¯å¼€æºã€‚

## è”ç³»æ–¹å¼

å¦‚æœ‰é—®é¢˜ï¼Œè¯·åœ¨ GitHub ä¸Šæäº¤ Issueã€‚
